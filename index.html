<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VOT - Video Organizer Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Orbitron:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      .sidebar {
        height: calc(100vh - 4rem);
        overflow-y: auto;
        position: sticky;
        top: 4rem;
      }
      .main-content {
        height: calc(100vh - 4rem);
        overflow-y: auto;
      }
      .tree-item {
        transition: all 0.2s ease;
      }
      .tree-item:hover {
        background-color: #374151;
      }
      .active-category {
        background-color: #4b5563;
        font-weight: 600;
      }
      .locked-category {
        opacity: 0.7;
      }
      .logo-text {
        font-family: "Orbitron", sans-serif;
        font-weight: 900;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      @media (max-width: 768px) {
        .sidebar {
          position: fixed;
          top: 4rem;
          left: 0;
          width: 100%;
          height: calc(100vh - 4rem);
          z-index: 40;
          transform: translateX(-100%);
          transition: transform 0.3s ease;
        }
        .sidebar.open {
          transform: translateX(0);
        }
        .overlay {
          position: fixed;
          top: 4rem;
          left: 0;
          width: 100%;
          height: calc(100vh - 4rem);
          background-color: rgba(0, 0, 0, 0.5);
          z-index: 30;
          display: none;
        }
        .overlay.open {
          display: block;
        }
      }
    </style>
  </head>
  <body class="bg-gray-900 text-gray-200">
    <header
      class="bg-gray-800 shadow-sm py-4 px-6 flex justify-between items-center border-b border-gray-700 sticky top-0 z-50"
    >
      <div class="flex items-center">
        <button
          id="menuToggle"
          class="md:hidden mr-4 text-gray-300 hover:text-white"
        >
          <i class="fas fa-bars text-xl"></i>
        </button>
        <div class="flex items-center">
          <h1 class="text-2xl font-bold">
            <span class="logo-text">VOT</span>
          </h1>
        </div>
      </div>
      <div class="text-sm text-gray-400 hidden md:block">Video Organizer</div>
    </header>

    <div class="overlay" id="overlay"></div>

    <div class="flex h-screen">
      <!-- Sidebar -->
      <div
        class="w-80 bg-gray-800 shadow-md sidebar flex-shrink-0"
        id="sidebar"
      >
        <div class="p-4 border-b border-gray-700 sticky top-0 bg-gray-800 z-10">
          <h2 class="font-semibold text-gray-300">Categories</h2>
        </div>
        <div id="categoryTree" class="p-2">
          <!-- Categories will load here -->
        </div>
      </div>

      <!-- Main Content -->
      <div class="flex-1 main-content">
        <div class="p-6">
          <div
            id="breadcrumb"
            class="mb-4 text-sm text-gray-400 flex items-center"
          >
            <span>Home</span>
          </div>
          <div id="contentArea">
            <!-- Home content will load here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Video Modal -->
    <div
      id="videoModal"
      class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden"
    >
      <div class="bg-gray-800 rounded-lg w-11/12 max-w-4xl">
        <div
          class="flex justify-between items-center p-4 border-b border-gray-700"
        >
          <h3 id="modalTitle" class="text-lg font-semibold text-white">
            Video Title
          </h3>
          <button id="closeModal" class="text-gray-400 hover:text-white">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        <div class="p-4">
          <div class="bg-black">
            <iframe
              id="modalVideo"
              width="100%"
              height="400"
              src=""
              frameborder="0"
              allowfullscreen
            ></iframe>
          </div>
          <div class="mt-4">
            <p id="videoDescription" class="text-gray-300"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Unlock Modal -->
    <div
      id="unlockModal"
      class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden"
    >
      <div class="bg-gray-800 rounded-lg w-11/12 max-w-md">
        <div
          class="flex justify-between items-center p-4 border-b border-gray-700"
        >
          <h3 id="unlockModalTitle" class="text-lg font-semibold text-white">
            Unlock Content
          </h3>
          <button id="closeUnlockModal" class="text-gray-400 hover:text-white">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        <div class="p-6">
          <div class="flex justify-center mb-4">
            <i class="fas fa-lock text-4xl text-yellow-500"></i>
          </div>
          <p id="unlockModalDescription" class="text-gray-300 text-center mb-4">
            This content is locked. Enter the access code to unlock it.
          </p>
          <div class="mb-4">
            <input
              type="password"
              id="unlockCode"
              placeholder="Enter access code"
              class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-indigo-500"
            />
            <p id="unlockError" class="text-red-400 text-sm mt-2 hidden">
              Invalid access code
            </p>
          </div>
          <button
            id="submitUnlock"
            class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-lg font-semibold"
          >
            Unlock Content
          </button>
        </div>
      </div>
    </div>

    <script src="video-data.js"></script>
    <script src="unlock-codes.js"></script>

    <script>
      // Simple state
      let currentCategory = null;
      let expandedCategories = new Set();
      let currentUnlockTarget = null;

      // DOM elements
      const categoryTree = document.getElementById("categoryTree");
      const contentArea = document.getElementById("contentArea");
      const breadcrumb = document.getElementById("breadcrumb");

      // Initialize
      function init() {
        renderCategoryTree(videoData, categoryTree, 0);
        showHome();
        setupEventListeners();
      }

      // Check if category is unlocked
      function isCategoryUnlocked(categoryId) {
        const unlocked = localStorage.getItem("votUnlockedCategories");
        if (!unlocked) return false;

        const data = JSON.parse(unlocked);
        const unlockInfo = data[categoryId];
        if (!unlockInfo) return false;

        // Check if 1 month has passed
        const oneMonthAgo = new Date();
        oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
        return new Date(unlockInfo.unlockedAt) > oneMonthAgo;
      }

      // Save unlocked category
      function saveUnlockedCategory(categoryId) {
        const unlocked = localStorage.getItem("votUnlockedCategories");
        const data = unlocked ? JSON.parse(unlocked) : {};
        data[categoryId] = { unlockedAt: new Date().toISOString() };
        localStorage.setItem("votUnlockedCategories", JSON.stringify(data));
      }

      // Render category tree
      function renderCategoryTree(categories, container, level) {
        container.innerHTML = "";

        categories.forEach((category) => {
          const hasChildren = category.children && category.children.length > 0;
          const hasVideos = category.videos && category.videos.length > 0;
          const isExpanded = expandedCategories.has(category.id);
          const isLocked = category.locked && !isCategoryUnlocked(category.id);

          const categoryElement = document.createElement("div");
          categoryElement.className = `tree-item ${
            isLocked ? "locked-category" : ""
          }`;

          const paddingLeft = level * 20;

          categoryElement.innerHTML = `
                    <div class="flex items-center py-2 px-4 cursor-pointer ${
                      currentCategory === category.id ? "active-category" : ""
                    }" 
                         style="padding-left: ${paddingLeft}px">
                        ${
                          hasChildren
                            ? `
                            <i class="fas fa-chevron-${
                              isExpanded ? "down" : "right"
                            } mr-2 text-gray-500 text-xs"></i>
                        `
                            : `
                            <i class="fas fa-minus mr-2 text-gray-600 text-xs"></i>
                        `
                        }
                        ${
                          isLocked
                            ? '<i class="fas fa-lock text-yellow-500 mr-2"></i>'
                            : hasVideos
                            ? '<i class="fas fa-play-circle text-blue-400 mr-2"></i>'
                            : '<i class="fas fa-folder text-yellow-500 mr-2"></i>'
                        }
                        <span class="text-gray-300">${category.name}</span>
                        ${
                          isLocked
                            ? '<span class="ml-2 text-xs text-yellow-500">Locked</span>'
                            : ""
                        }
                    </div>
                `;

          container.appendChild(categoryElement);

          // Click handler
          categoryElement
            .querySelector(".flex")
            .addEventListener("click", (e) => {
              e.stopPropagation();

              if (isLocked) {
                showUnlockModal(category);
                return;
              }

              if (hasChildren) {
                if (isExpanded) {
                  expandedCategories.delete(category.id);
                } else {
                  expandedCategories.add(category.id);
                }
                renderCategoryTree(videoData, categoryTree, 0);
              } else if (hasVideos) {
                selectCategory(category);
                if (window.innerWidth < 768) {
                  document.getElementById("sidebar").classList.remove("open");
                  document.getElementById("overlay").classList.remove("open");
                }
              }
            });

          // Render children
          if (hasChildren && isExpanded && !isLocked) {
            const childrenContainer = document.createElement("div");
            categoryElement.appendChild(childrenContainer);
            renderCategoryTree(category.children, childrenContainer, level + 1);
          }
        });
      }

      // Show unlock modal
      function showUnlockModal(category) {
        currentUnlockTarget = category;
        document.getElementById(
          "unlockModalTitle"
        ).textContent = `Unlock: ${category.name}`;
        document.getElementById("unlockModalDescription").textContent =
          category.unlockMessage || "Enter access code";
        document.getElementById("unlockCode").value = "";
        document.getElementById("unlockError").classList.add("hidden");
        document.getElementById("unlockModal").classList.remove("hidden");
      }

      // Hide unlock modal
      function hideUnlockModal() {
        document.getElementById("unlockModal").classList.add("hidden");
        currentUnlockTarget = null;
      }

      // Handle unlock
      function handleUnlock() {
        const code = document.getElementById("unlockCode").value.trim();
        const category = currentUnlockTarget;

        if (!category || !code) return;

        const validCode = unlockCodes[category.id];
        if (validCode && code === validCode) {
          saveUnlockedCategory(category.id);
          hideUnlockModal();
          renderCategoryTree(videoData, categoryTree, 0);

          if (category.videos && category.videos.length > 0) {
            selectCategory(category);
          }
        } else {
          document.getElementById("unlockError").classList.remove("hidden");
          document.getElementById("unlockCode").value = "";
        }
      }

      // Select category
      function selectCategory(category) {
        if (category.locked && !isCategoryUnlocked(category.id)) {
          showUnlockModal(category);
          return;
        }

        currentCategory = category.id;
        renderCategoryTree(videoData, categoryTree, 0);
        displayCategoryContent(category);
        updateBreadcrumb(category);
      }

      // Display category content
      function displayCategoryContent(category) {
        if (!category.videos || category.videos.length === 0) {
          contentArea.innerHTML = `
                    <div class="bg-gray-800 rounded-lg shadow p-6 text-center">
                        <i class="fas fa-folder-open text-5xl text-gray-600 mb-4"></i>
                        <h2 class="text-xl font-semibold text-gray-300 mb-2">${category.name}</h2>
                        <p class="text-gray-500">No videos in this category yet.</p>
                    </div>
                `;
          return;
        }

        let videosHTML = `
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-white mb-2">${
                      category.name
                    }</h2>
                    <p class="text-gray-400">${category.videos.length} video${
          category.videos.length !== 1 ? "s" : ""
        }</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            `;

        category.videos.forEach((video) => {
          videosHTML += `
                    <div class="bg-gray-800 rounded-lg shadow overflow-hidden">
                        <div class="relative">
                            <img src="https://img.youtube.com/vi/${video.youtubeId}/mqdefault.jpg" 
                                 alt="${video.title}" class="w-full h-40 object-cover">
                            <div class="absolute bottom-2 right-2 bg-black bg-opacity-80 text-white text-xs px-2 py-1 rounded">
                                ${video.duration}
                            </div>
                        </div>
                        <div class="p-4">
                            <h3 class="font-semibold text-white mb-2">${video.title}</h3>
                            <p class="text-gray-400 text-sm mb-4">${video.description}</p>
                            <button class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded play-video-btn" 
                                    data-video-id="${video.youtubeId}" 
                                    data-video-title="${video.title}" 
                                    data-video-description="${video.description}">
                                <i class="fas fa-play mr-2"></i> Watch Video
                            </button>
                        </div>
                    </div>
                `;
        });

        videosHTML += `</div>`;
        contentArea.innerHTML = videosHTML;

        // Add video play handlers
        document.querySelectorAll(".play-video-btn").forEach((button) => {
          button.addEventListener("click", (e) => {
            const videoId = button.dataset.videoId;
            const videoTitle = button.dataset.videoTitle;
            const videoDescription = button.dataset.videoDescription;

            document.getElementById(
              "modalVideo"
            ).src = `https://www.youtube.com/embed/${videoId}`;
            document.getElementById("modalTitle").textContent = videoTitle;
            document.getElementById("videoDescription").textContent =
              videoDescription;
            document.getElementById("videoModal").classList.remove("hidden");
          });
        });
      }

      // Update breadcrumb
      function updateBreadcrumb(category) {
        breadcrumb.innerHTML = `
                <span class="cursor-pointer text-blue-400 hover:text-blue-300" onclick="showHome()">Home</span>
                <i class="fas fa-chevron-right mx-2 text-gray-500"></i>
                <span>${category.name}</span>
            `;
      }

      // Show home page
      function showHome() {
        currentCategory = null;
        renderCategoryTree(videoData, categoryTree, 0);
        contentArea.innerHTML = `
                <div class="max-w-4xl mx-auto">
                    <div class="bg-gray-800 rounded-lg shadow p-8 text-center mb-8">
                        <div class="flex justify-center mb-6">
                            <div class="bg-gray-800 rounded-lg w-24 h-24 flex items-center justify-center border-2 border-purple-500">
                                <span class="logo-text text-4xl">VOT</span>
                            </div>
                        </div>
                        <h2 class="text-3xl font-bold text-white mb-4">Welcome to VOT</h2>
                        <p class="text-gray-300 text-lg mb-6">
                            Your personal YouTube video organizer
                        </p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-gray-800 rounded-lg shadow p-6">
                            <h3 class="text-xl font-bold text-white mb-4">MD Niaz Uddin Tanim</h3>
                            <p class="text-gray-300 mb-4">
                                This is my personal YouTube video organizer. Feel free to explore and learn from my curated content.
                            </p>
                        </div>

                        <div class="bg-gray-800 rounded-lg shadow p-6">
                            <h3 class="text-xl font-bold text-white mb-4">About This Project</h3>
                            <p class="text-gray-300">
                                Organized learning materials for everyone to benefit from.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        breadcrumb.innerHTML = "<span>Home</span>";
      }

      // Setup event listeners
      function setupEventListeners() {
        // Video modal
        document.getElementById("closeModal").addEventListener("click", () => {
          document.getElementById("videoModal").classList.add("hidden");
          document.getElementById("modalVideo").src = "";
        });

        document.getElementById("videoModal").addEventListener("click", (e) => {
          if (e.target === document.getElementById("videoModal")) {
            document.getElementById("videoModal").classList.add("hidden");
            document.getElementById("modalVideo").src = "";
          }
        });

        // Unlock modal
        document
          .getElementById("closeUnlockModal")
          .addEventListener("click", hideUnlockModal);
        document
          .getElementById("unlockModal")
          .addEventListener("click", (e) => {
            if (e.target === document.getElementById("unlockModal")) {
              hideUnlockModal();
            }
          });
        document
          .getElementById("submitUnlock")
          .addEventListener("click", handleUnlock);
        document
          .getElementById("unlockCode")
          .addEventListener("keypress", (e) => {
            if (e.key === "Enter") handleUnlock();
          });

        // Mobile menu
        document.getElementById("menuToggle").addEventListener("click", () => {
          document.getElementById("sidebar").classList.toggle("open");
          document.getElementById("overlay").classList.toggle("open");
        });

        document.getElementById("overlay").addEventListener("click", () => {
          document.getElementById("sidebar").classList.remove("open");
          document.getElementById("overlay").classList.remove("open");
        });

        // Escape key
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            document.getElementById("videoModal").classList.add("hidden");
            document.getElementById("modalVideo").src = "";
            hideUnlockModal();
          }
        });

        // Make showHome global
        window.showHome = showHome;
      }

      // Start the app
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
